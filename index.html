<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Speech Translator</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            min-height:100vh;
            display:flex;
            flex-direction:column;
            padding:20px;
            color:#333
        }
        .container{max-width:600px;width:100%;margin:0 auto;display:flex;flex-direction:column;gap:20px;flex:1}
        header{text-align:center;color:#fff;padding:20px 0}
        h1{font-size:2rem;font-weight:700;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,.2)}
        .subtitle{font-size:.9rem;opacity:.9}
        .language-selector{
            background:#fff;
            border-radius:20px;
            padding:20px;
            box-shadow:0 10px 30px rgba(0,0,0,.2)
        }
        .language-row{display:flex;align-items:center;gap:15px;margin-bottom:15px}
        .language-row:last-child{margin-bottom:0}
        label{font-weight:600;min-width:60px;font-size:.95rem}
        select{
            flex:1;padding:12px 15px;
            border:2px solid #e0e0e0;border-radius:12px;
            font-size:1rem;background:#fff;cursor:pointer;
            transition:.3s
        }
        select:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}
        .swap-btn{
            background:#667eea;color:#fff;border:none;
            width:45px;height:45px;border-radius:50%;
            font-size:1.3rem;cursor:pointer;
            display:flex;align-items:center;justify-content:center;
            margin:10px auto;transition:.3s;
            box-shadow:0 4px 12px rgba(102,126,234,.3)
        }
        .swap-btn:hover{transform:rotate(180deg);background:#764ba2}
        .swap-btn:active{transform:rotate(180deg) scale(.95)}
        .translation-area{
            background:#fff;border-radius:20px;padding:25px;
            box-shadow:0 10px 30px rgba(0,0,0,.2);
            flex:1;display:flex;flex-direction:column;gap:20px;
            max-height:500px
        }
        .text-box{position:relative;flex:1}
        .text-label{
            font-weight:600;margin-bottom:10px;
            display:block;color:#667eea;font-size:.9rem;
            text-transform:uppercase;letter-spacing:.5px
        }
        textarea{
            width:100%;min-height:120px;padding:15px;
            border:2px solid #e0e0e0;border-radius:12px;
            font-size:1rem;font-family:inherit;
            resize:vertical;transition:.3s
        }
        textarea:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}
        .controls{display:flex;gap:10px;margin-top:10px}
        .btn{
            flex:1;padding:15px 25px;border:none;
            border-radius:12px;font-size:1rem;font-weight:600;
            cursor:pointer;transition:.3s;
            display:flex;align-items:center;justify-content:center;
            gap:8px;box-shadow:0 4px 12px rgba(0,0,0,.15)
        }
        .btn-primary{
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            color:#fff
        }
        .btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(102,126,234,.4)}
        .btn-primary:active{transform:translateY(0)}
        .btn-secondary{
            background:#f5f5f5;color:#333
        }
        .btn-secondary:hover{background:#e0e0e0}
        .btn:disabled{
            opacity:.5;cursor:not-allowed;transform:none!important
        }
        .btn.recording{
            background:#ef4444;animation:pulse 1.5s infinite
        }
        @keyframes pulse{
            0%,100%{opacity:1}
            50%{opacity:.7}
        }
        .status{
            text-align:center;padding:12px;border-radius:12px;
            font-size:.9rem;font-weight:500;margin-top:10px;
            opacity:0;transition:opacity .3s
        }
        .status.show{opacity:1}
        .status.info{background:#e3f2fd;color:#1976d2}
        .status.success{background:#e8f5e9;color:#388e3c}
        .status.error{background:#ffebee;color:#d32f2f}
        .icon{font-size:1.2rem}
        .divider{
            height:2px;background:linear-gradient(90deg,transparent,#667eea,transparent);
            margin:10px 0
        }
        @media(max-width:480px){
            body{padding:15px}
            h1{font-size:1.5rem}
            .language-selector,.translation-area{padding:15px}
            .btn{padding:12px 20px;font-size:.9rem}
        }
    </style>
    <!-- Optional: make the page installable as a PWA -->
    <link rel="manifest" href="manifest.json">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåç Speech Translator</h1>
            <div class="subtitle">Speak naturally, translate instantly</div>
        </header>

        <div class="language-selector">
            <div class="language-row">
                <label for="fromLang">From:</label>
                <select id="fromLang">
                    <option value="en-US">English (US)</option>
                    <option value="en-GB">English (UK)</option>
                    <option value="es-ES">Spanish (Spain)</option>
                    <option value="es-MX">Spanish (Mexico)</option>
                    <option value="fr-FR">French</option>
                    <option value="de-DE">German</option>
                    <option value="it-IT">Italian</option>
                    <option value="pt-BR">Portuguese (Brazil)</option>
                    <option value="pt-PT">Portuguese (Portugal)</option>
                    <option value="ru-RU">Russian</option>
                    <option value="ja-JP">Japanese</option>
                    <option value="ko-KR">Korean</option>
                    <option value="zh-CN">Chinese (Simplified)</option>
                    <option value="zh-TW">Chinese (Traditional)</option>
                    <option value="ar-SA">Arabic</option>
                    <option value="hi-IN">Hindi</option>
                    <option value="nl-NL">Dutch</option>
                    <option value="pl-PL">Polish</option>
                    <option value="tr-TR">Turkish</option>
                    <option value="sv-SE">Swedish</option>
                </select>
            </div>

            <button class="swap-btn" id="swapBtn" title="Swap languages">‚áÖ</button>

            <div class="language-row">
                <label for="toLang">To:</label>
                <select id="toLang">
                    <option value="es">Spanish</option>
                    <option value="en">English</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                    <option value="it">Italian</option>
                    <option value="pt">Portuguese</option>
                    <option value="ru">Russian</option>
                    <option value="ja">Japanese</option>
                    <option value="ko">Korean</option>
                    <option value="zh-CN">Chinese (Simplified)</option>
                    <option value="zh-TW">Chinese (Traditional)</option>
                    <option value="ar">Arabic</option>
                    <option value="hi">Hindi</option>
                    <option value="nl">Dutch</option>
                    <option value="pl">Polish</option>
                    <option value="tr">Turkish</option>
                    <option value="sv">Swedish</option>
                    <option value="th">Thai</option>
                    <option value="vi">Vietnamese</option>
                    <option value="id">Indonesian</option>
                </select>
            </div>
        </div>

        <div class="translation-area">
            <div class="text-box">
                <label class="text-label">Original Text</label>
                <textarea id="inputText" placeholder="Tap the microphone to speak or type here..."></textarea>
                <div class="controls">
                    <button class="btn btn-primary" id="micBtn">
                        <span class="icon">üé§</span>
                        <span id="micBtnText">Speak</span>
                    </button>
                    <button class="btn btn-secondary" id="clearBtn">
                        <span class="icon">üóëÔ∏è</span>
                        Clear
                    </button>
                </div>
            </div>

            <div class="divider"></div>

            <div class="text-box">
                <label class="text-label">Translation</label>
                <textarea id="outputText" placeholder="Translation will appear here..." readonly></textarea>
                <div class="controls">
                    <button class="btn btn-primary" id="speakBtn" disabled>
                        <span class="icon">üîä</span>
                        Speak Translation
                    </button>
                    <button class="btn btn-secondary" id="copyBtn" disabled>
                        <span class="icon">üìã</span>
                        Copy
                    </button>
                </div>
            </div>

            <div class="status" id="status"></div>
        </div>
    </div>

    <script>
        // ---------- DOM references ----------
        const fromLang = document.getElementById('fromLang');
        const toLang   = document.getElementById('toLang');
        const swapBtn  = document.getElementById('swapBtn');
        const inputText = document.getElementById('inputText');
        const outputText = document.getElementById('outputText');
        const micBtn   = document.getElementById('micBtn');
        const micBtnText = document.getElementById('micBtnText');
        const clearBtn = document.getElementById('clearBtn');
        const speakBtn = document.getElementById('speakBtn');
        const copyBtn  = document.getElementById('copyBtn');
        const status   = document.getElementById('status');

        // ---------- Speech recognition ----------
        let recognition;
        let isRecording = false;
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.maxAlternatives = 1;

            recognition.onstart = () => {
                isRecording = true;
                micBtn.classList.add('recording');
                micBtnText.textContent = 'Listening‚Ä¶';
                showStatus('Listening‚Ä¶ Speak now', 'info');
            };

            recognition.onresult = e => {
                let interim = '', final = '';
                for (let i = e.resultIndex; i < e.results.length; ++i) {
                    const transcript = e.results[i][0].transcript;
                    e.results[i].isFinal ? final += transcript + ' ' : interim += transcript;
                }
                if (final) {
                    inputText.value = final.trim();
                    translateText();
                } else {
                    inputText.value = interim;
                }
            };

            recognition.onerror = e => {
                console.error('SR error', e);
                isRecording = false;
                micBtn.classList.remove('recording');
                micBtnText.textContent = 'Speak';
                const msg = e.error === 'not-allowed' ? 'Microphone permission denied.'
                          : e.error === 'no-speech' ? 'No speech detected.'
                          : `Error: ${e.error}`;
                showStatus(msg, 'error');
            };

            recognition.onend = () => {
                isRecording = false;
                micBtn.classList.remove('recording');
                micBtnText.textContent = 'Speak';
            };
        }

        // ---------- Language map for TTS ----------
        const speechLangMap = {
            es: 'es-ES', en: 'en-US', fr: 'fr-FR', de: 'de-DE',
            it: 'it-IT', pt: 'pt-PT', ru: 'ru-RU', ja: 'ja-JP',
            ko: 'ko-KR', 'zh-CN': 'zh-CN', 'zh-TW': 'zh-TW',
            ar: 'ar-SA', hi: 'hi-IN', nl: 'nl-NL', pl: 'pl-PL',
            tr: 'tr-TR', sv: 'sv-SE', th: 'th-TH', vi: 'vi-VN',
            id: 'id-ID'
        };

        // ---------- UI event listeners ----------
        micBtn.addEventListener('click', () => {
            if (!recognition) {
                showStatus('Speech recognition not supported.', 'error');
                return;
            }
            if (isRecording) recognition.stop();
            else {
                recognition.lang = fromLang.value;
                recognition.start();
            }
        });

        clearBtn.addEventListener('click', () => {
            inputText.value = '';
            outputText.value = '';
            speakBtn.disabled = true;
            copyBtn.disabled = true;
            hideStatus();
        });

        swapBtn.addEventListener('click', () => {
            const fromVal = fromLang.value;
            const toVal   = toLang.value;

            // Find a matching speech‚Äërecognition code for the target language
            let newFrom = 'en-US';
            for (let opt of fromLang.options) {
                if (opt.value.startsWith(toVal)) { newFrom = opt.value; break; }
            }
            fromLang.value = newFrom;
            toLang.value   = fromVal.split('-')[0];

            // Swap the text boxes
            const tmp = inputText.value;
            inputText.value = outputText.value;
            outputText.value = tmp;
            if (inputText.value) translateText();
        });

        inputText.addEventListener('input', () => {
            if (inputText.value.trim()) translateText();
            else {
                outputText.value = '';
                speakBtn.disabled = true;
                copyBtn.disabled = true;
            }
        });

        speakBtn.addEventListener('click', () => {
            if (outputText.value) speakText(outputText.value, toLang.value);
        });

        copyBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(outputText.value);
                showStatus('Copied to clipboard!', 'success');
            } catch {
                // fallback for older browsers
                outputText.select();
                document.execCommand('copy');
                showStatus('Copied to clipboard!', 'success');
            }
        });

        // ---------- Translation (MyMemory free API) ----------
        let translateTimer;
        async function translateText() {
            clearTimeout(translateTimer);
            const txt = inputText.value.trim();
            if (!txt) {
                outputText.value = '';
                speakBtn.disabled = true;
                copyBtn.disabled = true;
                return;
            }

            translateTimer = setTimeout(async () => {
                try {
                    showStatus('Translating‚Ä¶', 'info');
                    const src = fromLang.value.split('-')[0];
                    const tgt = toLang.value;
                    const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(txt)}&langpair=${src}|${tgt}`;
                    const resp = await fetch(url);
                    const data = await resp.json();

                    if (data.responseStatus === 200 && data.responseData.translatedText) {
                        outputText.value = data.responseData.translatedText;
                        speakBtn.disabled = false;
                        copyBtn.disabled = false;
                        showStatus('Translation ready!', 'success');
                    } else {
                        throw new Error('Bad response');
                    }
                } catch (e) {
                    console.error(e);
                    showStatus('Translation failed ‚Äì try again.', 'error');
                    outputText.value = '';
                    speakBtn.disabled = true;
                    copyBtn.disabled = true;
                }
            }, 500); // debounce
        }

        // ---------- Text‚Äëto‚ÄëSpeech ----------
        function speakText(txt, lang) {
            if (!('speechSynthesis' in window)) {
                showStatus('Text‚Äëto‚Äëspeech not supported.', 'error');
                return;
            }
            window.speechSynthesis.cancel();
            const utter = new SpeechSynthesisUtterance(txt);
            utter.lang = speechLangMap[lang] || lang;
            utter.rate = 0.9;
            const voices = speechSynthesis.getVoices();
            const voice = voices.find(v => v.lang.startsWith(utter.lang.split('-')[0]));
            if (voice) utter.voice = voice;

            utter.onstart = () => showStatus('Speaking‚Ä¶', 'info');
            utter.onend   = () => hideStatus();
            utter.onerror = () => showStatus('Speech error.', 'error');

            speechSynthesis.speak(utter);
        }

        // Load voices for browsers that populate them lazily
        if ('speechSynthesis' in window) {
            speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
        }

        // ---------- Status helpers ----------
        let statusTimer;
        function showStatus(msg, type) {
            clearTimeout(statusTimer);
            status.textContent = msg;
            status.className = `status show ${type}`;
            if (type !== 'info') statusTimer = setTimeout(hideStatus, 3000);
        }
        function hideStatus() {
            status.classList.remove('show');
        }

        // ---------- Feature‚Äëdetect on load ----------
        window.addEventListener('load', () => {
            if (!recognition) {
                showStatus('‚ö†Ô∏è Speech recognition unavailable ‚Äì you can still type & translate.', 'error');
                micBtn.disabled = true;
            }
            if (!('speechSynthesis' in window)) {
                showStatus('‚ö†Ô∏è Text‚Äëto‚Äëspeech unavailable in this browser.', 'error');
            }
        });
    </script>
</body>
</html>
